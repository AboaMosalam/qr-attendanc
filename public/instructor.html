<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ† - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="nav">
            <a href="/">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="/student">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</a>
        </div>

        <h1>ğŸ‘¨â€ğŸ« Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ†</h1>

        <!-- Alert Messages -->
        <div id="alert-container"></div>

        <!-- Login Section -->
        <div id="login-section" class="glass-card" style="max-width: 500px; margin: 0 auto;">
            <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">
                Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </p>

            <form id="login-form">
                <div class="form-group">
                    <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label>
                    <input type="text" id="username" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>

                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                    <input type="password" id="password" required placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>

                <div class="form-group">
                    <label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯)</label>
                    <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                </div>

                <div class="form-group">
                    <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯)</label>
                    <input type="email" id="email" placeholder="example@university.edu">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                </button>
            </form>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="hidden">
            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="instructor-name"></span></h2>
                    <button id="logout-btn" class="btn" style="background: rgba(255,255,255,0.1);">
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </button>
                </div>

                <!-- Create Session Form -->
                <div class="card" style="margin-bottom: 30px;">
                    <h3>ğŸ“‹ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø­Ø¶ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <form id="create-session-form" style="margin-top: 20px;">
                        <div class="grid">
                            <div class="form-group">
                                <label for="course-name">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                                <input type="text" id="course-name" required placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙƒØ§Ø¦Ù†ÙŠØ©">
                            </div>

                            <div class="form-group">
                                <label for="lecture-title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© *</label>
                                <input type="text" id="lecture-title" required placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©">
                            </div>

                            <div class="form-group">
                                <label for="duration">Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚) *</label>
                                <input type="number" id="duration" required value="60" min="5" max="240">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-success" style="width: 100%;">
                            âœ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR
                        </button>
                    </form>
                </div>

                <!-- QR Code Display -->
                <div id="qr-display" class="hidden">
                    <div class="qr-container">
                        <h3 style="color: #333; margin-bottom: 20px;">Ø±Ù…Ø² QR Ù„Ù„Ø­Ø¶ÙˆØ±</h3>
                        <div id="session-info" style="color: #666; margin-bottom: 20px;"></div>
                        <div id="qrcode"></div>
                        <p style="color: #666; margin-top: 20px; font-size: 0.9rem;">
                            Ø§Ø¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù„Ù„Ø·Ù„Ø§Ø¨ Ù„ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ù‡Ù…
                        </p>
                        <div style="margin-top: 20px;">
                            <button id="close-qr-btn" class="btn btn-primary">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Active Sessions -->
                <div class="card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ“Š Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                        <button id="refresh-sessions-btn" class="btn btn-primary">
                            ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                    <div id="sessions-list"></div>
                </div>

                <!-- Attendance Reports -->
                <div class="card" style="margin-top: 30px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ“ˆ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                        <button id="export-all-btn" class="btn btn-success">
                            ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                        </button>
                    </div>
                    <div id="reports-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api';
        let currentInstructor = null;
        let currentSessions = [];

        // Show alert message
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);

            setTimeout(() => {
                alert.style.animation = 'fadeInUp 0.5s ease-out reverse';
                setTimeout(() => alert.remove(), 500);
            }, 5000);
        }

        // Login Form
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const loginData = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value
            };

            try {
                const response = await fetch(`${API_URL}/instructors/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(loginData)
                });

                const data = await response.json();

                if (response.ok) {
                    currentInstructor = data.instructor;
                    showAlert('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!', 'success');
                    showDashboard();
                } else {
                    showAlert(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
                }
            } catch (error) {
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                console.error('Error:', error);
            }
        });

        // Show Dashboard
        function showDashboard() {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('dashboard-section').classList.remove('hidden');
            document.getElementById('instructor-name').textContent = currentInstructor.name;
            loadSessions();
            loadReports();
        }

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            currentInstructor = null;
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('login-form').reset();
        });

        // Create Session
        document.getElementById('create-session-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const sessionData = {
                instructorId: currentInstructor.id,
                courseName: document.getElementById('course-name').value,
                lectureTitle: document.getElementById('lecture-title').value,
                duration: parseInt(document.getElementById('duration').value)
            };

            try {
                const response = await fetch(`${API_URL}/sessions/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sessionData)
                });

                const data = await response.json();

                if (response.ok) {
                    showAlert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    displayQRCode(data.session);
                    document.getElementById('create-session-form').reset();
                    loadSessions();
                } else {
                    showAlert(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©', 'error');
                }
            } catch (error) {
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                console.error('Error:', error);
            }
        });

        // Display QR Code
        function displayQRCode(session) {
            const qrDisplay = document.getElementById('qr-display');
            const qrContainer = document.getElementById('qrcode');
            const sessionInfo = document.getElementById('session-info');

            // Clear previous QR
            qrContainer.innerHTML = '';

            // Show session info
            sessionInfo.innerHTML = `
                <strong>${session.courseName}</strong><br>
                ${session.lectureTitle}<br>
                <small>ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© ${session.duration} Ø¯Ù‚ÙŠÙ‚Ø©</small>
            `;

            // Generate QR code
            new QRCode(qrContainer, {
                text: session.qrCode,
                width: 256,
                height: 256,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            qrDisplay.classList.remove('hidden');
        }

        // Close QR Display
        document.getElementById('close-qr-btn').addEventListener('click', () => {
            document.getElementById('qr-display').classList.add('hidden');
        });

        // Load Sessions
        async function loadSessions() {
            if (!currentInstructor) return;

            try {
                const response = await fetch(`${API_URL}/sessions/instructor/${currentInstructor.id}`);
                const sessions = await response.json();
                currentSessions = sessions;

                const sessionsList = document.getElementById('sessions-list');

                if (sessions.length === 0) {
                    sessionsList.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø©</p>';
                    return;
                }

                // Filter active sessions (not expired)
                const activeSessions = sessions.filter(s => new Date(s.expiresAt) > new Date());

                if (activeSessions.length === 0) {
                    sessionsList.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø©</p>';
                    return;
                }

                sessionsList.innerHTML = activeSessions.map(session => `
                    <div class="card" style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h4 style="color: var(--text-primary); margin-bottom: 8px;">${session.courseName}</h4>
                                <p style="color: var(--text-secondary); margin-bottom: 4px;">${session.lectureTitle}</p>
                                <p style="color: var(--text-secondary); font-size: 0.85rem;">
                                    ØªÙ†ØªÙ‡ÙŠ ÙÙŠ: ${new Date(session.expiresAt).toLocaleString('ar-EG')}
                                </p>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="showSessionQR('${session.id}')" class="btn btn-primary">
                                    Ø¹Ø±Ø¶ QR
                                </button>
                                <button onclick="viewAttendance('${session.id}')" class="btn btn-success">
                                    Ø§Ù„Ø­Ø¶ÙˆØ±
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading sessions:', error);
            }
        }

        // Show Session QR
        window.showSessionQR = function (sessionId) {
            const session = currentSessions.find(s => s.id === sessionId);
            if (session) {
                displayQRCode(session);
            }
        };

        // View Attendance for Session
        window.viewAttendance = async function (sessionId) {
            try {
                const response = await fetch(`${API_URL}/attendance/session/${sessionId}`);
                const attendance = await response.json();

                const session = currentSessions.find(s => s.id === sessionId);

                if (attendance.length === 0) {
                    showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¶ÙˆØ± Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø¹Ø¯', 'info');
                    return;
                }

                // Create modal to show attendance
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `;

                modal.innerHTML = `
                    <div class="glass-card" style="max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <h3>Ø­Ø¶ÙˆØ±: ${session.courseName} - ${session.lectureTitle}</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¶ÙˆØ±: ${attendance.length} Ø·Ø§Ù„Ø¨
                        </p>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</th>
                                    <th>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${attendance.map((record, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${record.studentName}</td>
                                        <td>${record.studentId}</td>
                                        <td>${new Date(record.markedAt).toLocaleString('ar-EG')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                            <button onclick="exportSessionToExcel('${sessionId}')" class="btn btn-success">
                                ğŸ“¥ ØªØµØ¯ÙŠØ± Excel
                            </button>
                            <button onclick="this.closest('[style*=fixed]').remove()" class="btn btn-primary">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Close on background click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            } catch (error) {
                showAlert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±', 'error');
                console.error('Error:', error);
            }
        };

        // Load Reports
        async function loadReports() {
            if (!currentInstructor) return;

            try {
                const response = await fetch(`${API_URL}/attendance/instructor/${currentInstructor.id}`);
                const reports = await response.json();

                const reportsList = document.getElementById('reports-list');

                if (reports.length === 0) {
                    reportsList.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªØ§Ø­Ø©</p>';
                    return;
                }

                reportsList.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                <th>Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${reports.map(report => `
                                <tr>
                                    <td>${report.courseName}</td>
                                    <td>${report.lectureTitle}</td>
                                    <td>${new Date(report.createdAt).toLocaleDateString('ar-EG')}</td>
                                    <td>${report.attendees.length}</td>
                                    <td>
                                        <button onclick="exportSessionToExcel('${report.id}')" class="btn btn-success" style="padding: 8px 16px;">
                                            ğŸ“¥ ØªØµØ¯ÙŠØ±
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error('Error loading reports:', error);
            }
        }

        // Export to Excel
        window.exportSessionToExcel = async function (sessionId) {
            try {
                const [sessionRes, attendanceRes] = await Promise.all([
                    fetch(`${API_URL}/sessions/instructor/${currentInstructor.id}`),
                    fetch(`${API_URL}/attendance/session/${sessionId}`)
                ]);

                const sessions = await sessionRes.json();
                const attendance = await attendanceRes.json();
                const session = sessions.find(s => s.id === sessionId);

                if (!session) {
                    showAlert('Ø§Ù„Ø¬Ù„Ø³Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
                    return;
                }

                // Prepare data
                const data = attendance.map((record, index) => ({
                    '#': index + 1,
                    'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨': record.studentName,
                    'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ': record.studentId,
                    'ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„': new Date(record.markedAt).toLocaleString('ar-EG')
                }));

                // Create workbook
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(data);

                // Add headers
                XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ø­Ø¶ÙˆØ±');

                // Download
                const filename = `Ø­Ø¶ÙˆØ±_${session.courseName}_${session.lectureTitle}_${new Date().toLocaleDateString('ar-EG')}.xlsx`;
                XLSX.writeFile(wb, filename);

                showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            } catch (error) {
                showAlert('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù', 'error');
                console.error('Error:', error);
            }
        };

        // Export All Reports
        document.getElementById('export-all-btn').addEventListener('click', async () => {
            try {
                const response = await fetch(`${API_URL}/attendance/instructor/${currentInstructor.id}`);
                const reports = await response.json();

                if (reports.length === 0) {
                    showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù„ØªØµØ¯ÙŠØ±', 'info');
                    return;
                }

                const wb = XLSX.utils.book_new();

                for (const report of reports) {
                    if (report.attendees.length === 0) continue;

                    const data = report.attendees.map((record, index) => ({
                        '#': index + 1,
                        'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨': record.studentName,
                        'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ': record.studentId,
                        'ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„': new Date(record.markedAt).toLocaleString('ar-EG')
                    }));

                    const ws = XLSX.utils.json_to_sheet(data);
                    const sheetName = `${report.courseName.substring(0, 20)}_${new Date(report.createdAt).toLocaleDateString('en-GB')}`;
                    XLSX.utils.book_append_sheet(wb, ws, sheetName);
                }

                const filename = `Ø¬Ù…ÙŠØ¹_Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±_${new Date().toLocaleDateString('ar-EG')}.xlsx`;
                XLSX.writeFile(wb, filename);

                showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            } catch (error) {
                showAlert('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', 'error');
                console.error('Error:', error);
            }
        });

        // Refresh Sessions
        document.getElementById('refresh-sessions-btn').addEventListener('click', () => {
            loadSessions();
            loadReports();
            showAlert('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'success');
        });

        // Auto refresh every 30 seconds
        setInterval(() => {
            if (currentInstructor) {
                loadSessions();
            }
        }, 30000);
    </script>
</body>

</html>